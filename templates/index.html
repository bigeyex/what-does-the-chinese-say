
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Template &middot; Bootstrap</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet" media="screen">
    <style type="text/css">
      body {
        padding-top: 20px;
        padding-bottom: 60px;
      }

      /* Custom container */
      .container {
        margin: 0 auto;
        max-width: 1000px;
      }
      .container > hr {
        margin: 60px 0;
      }

      /* Main marketing message and sign up button */
      .jumbotron {
        margin: 80px 0;
        text-align: center;
      }
      .jumbotron h1 {
        font-size: 100px;
        line-height: 1;
      }
      .jumbotron .lead {
        font-size: 24px;
        line-height: 1.25;
      }
      .jumbotron .btn {
        font-size: 21px;
        padding: 14px 24px;
      }

      /* Supporting marketing content */
      .marketing {
        margin: 60px 0;
      }
      .marketing p + h4 {
        margin-top: 28px;
      }


      /* Customize the navbar links to be fill the entire space of the .navbar */
      .navbar .navbar-inner {
        padding: 0;
      }
      .navbar .nav {
        margin: 0;
        display: table;
        width: 100%;
      }
      .navbar .nav li {
        display: table-cell;
        width: 1%;
        float: none;
      }
      .navbar .nav li a {
        font-weight: bold;
        text-align: center;
        border-left: 1px solid rgba(255,255,255,.75);
        border-right: 1px solid rgba(0,0,0,.1);
      }
      .navbar .nav li:first-child a {
        border-left: 0;
        border-radius: 3px 0 0 3px;
      }
      .navbar .nav li:last-child a {
        border-right: 0;
        border-radius: 0 3px 3px 0;
      }
      
      .input-toolbar{
          margin-bottom: 0;
          margin-right: 10px;
      }
      
      #json-view{
          margin-top: 25px;
      }
      
      #json-result{
          margin-top: 10px;
          width: 100%;
      }
      
      .input-append{
          margin-bottom: 0;
      }
      
      .view-frame{
          min-height: 500px;
      }
      
      span.page-tag{
          display: inline-block;
          font-size: 14px;
            padding: 0 10px;
      }
      
      #banner{
          background: url('/static/img/banner.png');
          height: 181px;
          text-indent: -9999px;
      }
    </style>
    <link href="{{ url_for('static', filename='css/bootstrap-responsive.min.css') }}" rel="stylesheet" media="screen">
  </head>

  <body>

    <div class="container">

      <div class="masthead">
        <h3 class="muted" id="banner">What does the Chinese Say</h3>
        <div class="navbar">
          <div class="navbar-inner">
            <div class="container">
              <ul class="nav">
                <li class="active"><a href="#">Search</a></li>
                <li><a href="#">What's this?</a></li>
                <li><a href="#">Github</a></li>
              </ul>
            </div>
          </div>
        </div><!-- /.navbar -->
      </div>
      
      <div class="row-fluid">
          <div class="btn-toolbar">
              <div class="btn-group form-inline input-append">
                  <input type="text" class=" input-medium" id="search-keywords" placeholder="Obama"/>
                  <button class="btn btn-primary" id="search-button">Search</button>
              </div>
              <div class="btn-group" data-role="radio" name="data_type">
                    <button class="btn active" value="news">News</button>
                    <button class="btn" value="blog">Blogs</button>
                    <button class="btn" value="forum">Forum</button>
                    <button class="btn" value="weibo">Weibo(Tweets)</button>
              </div>
              <div class="btn-group" data-role="checkbox">
                    <button class="btn active" name="translate_input" value="1">Translate Keywords</button>
                    <button class="btn active" name="translate" value="1">Translate Result</button>
              </div>
              <div class="btn-group" data-role="switch-view" name="result_format">
                    <button class="btn active" value="web">Web</button>
                    <button class="btn" value="json">JSON</button>
              </div>
          </div>
          <div class="form-inline">
              
          </div>
      </div>
      
      <div id="loader" style="display:none;">
        <img src="{{ url_for('static', filename='img/loader.gif') }}"/><span id="loading-message">Loading...</span>
      </div>
      
      <div id="web-view" class="view-frame" view-name="web">
        <div class="btn-toolbar">
            <button class="btn" style="display:none;" id="prev-page-button">Prev Page</button>
            <span class="page-tag">Page <span class="page-no">1</span></span>
            <button class="btn" style="display:none;" id="next-page-button">Next Page</button>
        </div>
        <table class="table" id="web-result-table">
            <tr>
                <td> 
                </td>
            </tr>
        </table>
      </div>

      <div id="json-view" class="view-frame" view-name="json" style="display:none;"	>
        <div class="form-inline">
              Resource URI: 
              <input type="text" class="input-block-level input-toolbar" id="json_request_uri" value="" placeholder="Click Search to see resource URI.."/>
        </div>
        <div>      
            <textarea id="json-result" rows="30"></textarea>
        </div>
      </div>

      

      <div class="footer">
        <p>Wang Yu @ Center for Civic Media 2014</p>
      </div>

    </div> <!-- /container -->
      <script src="{{ url_for('static', filename='js/jquery-1.11.1.min.js') }}"></script>
      <script>
          var data_type="news";
          var keyword = "";
          var result_format = "web";
          var translate = "1";
          var translate_input = "1";
          var page = 1;
          var json_request_uri;
          var json_base_uri = "{{ url_for('json', _external=True) }}";
          
          function build_uri(){
             var request_part = "?s="+keyword+"&type="+data_type+"&page="+page;
             if(translate == "1"){
                request_part+="&translate=1";
             }
             if(translate_input == "1"){
                request_part+="&translate_input=1";
             }
             json_request_uri = json_base_uri+request_part;
          }
          
          function do_search(){
            keyword = $('#search-keywords').val();
            build_uri();
            $('#json_request_uri').val(json_request_uri);

            if(result_format == 'json'){
                $('#json-result').text('loading json...');
                start_loader();
                $.get(json_request_uri, function(result){
                    stop_loader();
                    $('#json-result').text(JSON.stringify(result, undefined, 2));
                });
            }
            else if (result_format == 'web'){
                start_loader();
                $.get(json_request_uri, function(result){
                    stop_loader();
                    $('.page-no').text(page);
                    $('#web-result-table').empty();
                    for(var ri in result.result){
                        var record = result.result[ri];
                        if(record.title === undefined){
                            content_str = record.content+'<br/><a href="'+record.link+'" target="_blank">Original Tweet</a>';
                            $('#web-result-table').append('<tr><td>'+content_str+'</td></tr>');
                        }
                        else{   // news type
                            content_str = '<a href="'+record.link+'" target="_blank">'+record.title+'</a><br/>'+record.content;
                            $('#web-result-table').append('<tr><td>'+content_str+'</td></tr>');
                        }
                    }
                    if(page > 1){
                        $('#prev-page-button').show();
                    }
                    else{
                        $('#prev-page-button').hide();
                    }
                    if(result.has_next_page){
                        $('#next-page-button').show();
                    }
                    else{
                        $('#next-page-button').hide();
                    }
                }, 'json');
            }
          }
          
          $('div[data-role="radio"] button').click(function(e){
                var target = $(e.currentTarget);
                var parent = $(target).parent();
                var name = parent.attr('name');
                var value = target.attr('value');
                window[name] = value;
                parent.find('button').removeClass('active');
                target.addClass('active');
          });
          
          $('div[data-role="switch-view"] button').click(function(e){
                var target = $(e.currentTarget);
                var parent = $(target).parent();
                var name = parent.attr('name');
                var value = target.attr('value');
                window[name] = value;
                parent.find('button').removeClass('active');
                target.addClass('active');
                $('.view-frame').hide();
                $('div[view-name="'+value+'"]').show();
          });
          
          $('div[data-role="checkbox"] button').click(function(e){
                var target = $(e.currentTarget);
                var name = target.attr('name');
                var value = target.attr('value');
                if(target.hasClass('active')){
                    // delete check status
                    window[name]='';
                }
                else{
                    window[name] = value;
                }
                target.toggleClass('active');
          });
          
          $('#search-button').click(function(){
                do_search();
          });
          
          $('#search-keywords').keydown(function(event) {
                if (event.keyCode == 13) {
                    do_search();
                    return false;
                 }
          });
          
          $('#prev-page-button').click(function(){
                page--;
                if(page < 1) page=1;
                do_search();
          });
          
          $('#next-page-button').click(function(){
                page++;
                do_search();
          });
          
          var loader_dots = 0;
          var loader_timer = null;
          var loader_messages = ["Building Babel Tower", "Busy translating", "Hiring a translator", "Finding translation robot", "Casting translation spell", "Oiling translation engine", "Contacting embassy"];
          function update_loader(){
             var random_number = Math.floor(Math.random() * loader_messages.length);
             var message = loader_messages[random_number];
             message+="..."
             loader_dots++;
             $('#loading-message').text(message);
          }
          function start_loader(){
            loader_timer = setInterval(update_loader, 1000);
            $('#loader').show();
          }
          function stop_loader(){
            clearInterval(loader_timer);
            $('#loader').hide();
          }
      </script>
  </body>
</html>
